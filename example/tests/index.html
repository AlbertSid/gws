<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<button onclick="onTest()">Test</button>
<button onclick="onVerify()">Verify</button>
<button onclick="onBench()">Bench</button>

<script>
    let ws = new WebSocket("ws://127.0.0.1:3000/ws");

    let count = 0;
    let t0 = 0;
    let t1 = 0;

    function onTest() {
        // for (let i = 0; i < 100000; i++) {
            ws.send("test");
        // }
    }

    function onVerify() {
        ws.send("verify");
    }

    function onBench() {
        count = 0;
        t0 = Date.now();
        ws.send("bench");
    }


    ws.onmessage = function (msg) {
        if (msg.data != "ok") {
            ws.send(msg.data);
            count++;
        }
        if (count == 100000) {
            t1 = Date.now();
            alert((t1 - t0) + "ms");
        }
    }

    ws.onerror = function (e) {
        console.log(e);
    }

    ws.onclose = function (e) {
        console.log(e, Date.now());
    }
    // document.ws = ws;
    // setTimeout(() => {
    // ws.send("Hi!")
    // ws.send('因为 WebSocket 支持将长消息切分为若干个 frame 发送, 切分以后, 除了最后一个 frame, 前面的 frame 的 FIN 字段都为 0, 最后一个 frame 的 FIN 字段为 1, 当然, 若消息没有分段, 那么一个 frame 便包含了完成的消息, 此时其 FIN 字段值为 1')
    // }, 1000)

    // rand
</script>
</body>
</html>