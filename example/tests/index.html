<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        #app {
            width: 300px;
            margin: 100px auto;
        }

        .line .btn {
            width: 85px;
            display: inline-block;
            margin: 5px 5px;
        }
    </style>
</head>
<body>

<div id="app">
    <div class="line">
        <button onclick="onTest()" class="btn">Test</button>
        <button onclick="onVerify()" class="btn">Verify</button>
        <button onclick="onBench()" class="btn">Bench</button>
    </div>

    <div class="line">
        <button onclick="onPing()" class="btn">Ping</button>
        <button onclick="onPong()" class="btn">Pong</button>
        <button onclick="onClose()" class="btn">Close</button>
    </div>
</div>


<script>
    let ws = new WebSocket("ws://127.0.0.1:3000/ws");
    // let ws = new WebSocket("ws://192.168.31.98:3000/ws");

    let count = 0;
    let t0 = 0;
    let t1 = 0;

    function onTest() {
        ws.send("test");
    }

    function onVerify() {
        ws.send("verify");
    }

    function onPing() {
        ws.send("ping");
    }

    function onPong() {
        ws.send("pong");
    }

    function onClose() {
        ws.send("close");
    }

    function onBench() {
        count = 0;
        t0 = Date.now();
        ws.send("bench");
    }


    ws.onmessage = function (msg) {
        if (msg.data != "ok") {
            ws.send(msg.data);
            count++;
        }
        if (count == 1000000) {
            t1 = Date.now();
            alert((t1 - t0) + "ms");
        }
    }

    ws.onerror = function (e) {
        console.log(e);
    }

    ws.onclose = function (e) {
        console.log(e, Date.now());
    }
</script>
</body>
</html>
